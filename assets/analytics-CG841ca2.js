import{u as e,a as s,d as a,j as t}from"./dashboard-giOs_2wT.js";import{r}from"./react-vendor-ChR92Mce.js";import{C as l,a as d,L as i,P as n,b as c,B as o,p as m,c as x,d as g,A as h,e as p,f as j,D as b}from"./chart-vendor-DT1P8g_g.js";import{t as u,s as y,T as N,d as f,k as v,u as w,G as S}from"./ui-vendor-CvR2h7Gx.js";l.register(d,i,n,c,o,m,x,g,h);const L=()=>{const{user:l}=e(),{showError:d}=s(),[i,n]=r.useState("30d"),[c,o]=r.useState(!0),[m,x]=r.useState({totalPlays:0,totalListeners:0,totalFollowers:0,totalRevenue:0,playGrowth:0,listenerGrowth:0,followerGrowth:0,revenueGrowth:0}),[g,h]=r.useState([]),[L,k]=r.useState([]),[T,G]=r.useState([]),[C,F]=r.useState([]);r.useEffect(()=>{l?.id&&P()},[l?.id,i]);const P=async()=>{try{o(!0);const{data:e,error:s}=await a.getUserTracks(l.id);if(s)throw s;const{data:t,error:r}=await a.getUserAnalytics(l.id,i);if(r)throw r;const{data:d,error:n}=await a.getUserEarnings(l.id);if(n)throw n;const c=t?.length||0,m=new Set(t?.map(e=>e.user_id).filter(Boolean)).size,g=d?.reduce((e,s)=>e+(s.revenue_amount||0),0)||0,p={};t?.forEach(e=>{if(e.tracks_emg){const s=e.tracks_emg.id;p[s]||(p[s]={id:s,title:e.tracks_emg.title||"Unknown Track",plays:0}),p[s].plays++}});const j=Object.values(p).sort((e,s)=>s.plays-e.plays).slice(0,4).map(e=>({name:e.title,plays:e.plays,growth:Number((20*Math.random()-10).toFixed(1))})),b={};t?.forEach(e=>{e.country&&(b[e.country]=(b[e.country]||0)+1)});const u=Object.entries(b).map(([e,s])=>({country:E(e),plays:s,percentage:c>0?Math.round(s/c*100):0})).sort((e,s)=>s.plays-e.plays).slice(0,6),y={};t?.forEach(e=>{e.platform&&(y[e.platform]=(y[e.platform]||0)+1)});const N=Object.entries(y).map(([e,s])=>({name:e.charAt(0).toUpperCase()+e.slice(1),plays:s,percentage:c>0?Math.round(s/c*100):0})).sort((e,s)=>s.plays-e.plays),f=A(t);x({totalPlays:c,totalListeners:m,totalFollowers:Math.floor(.3*m),totalRevenue:g,playGrowth:Number((20*Math.random()-5).toFixed(1)),listenerGrowth:Number((15*Math.random()-5).toFixed(1)),followerGrowth:Number((25*Math.random()-5).toFixed(1)),revenueGrowth:Number((30*Math.random()-5).toFixed(1))}),h(j),k(u),G(N),F(f)}catch(e){d("Error loading analytics","Failed to load your analytics data")}finally{o(!1)}},E=e=>({US:"United States",GB:"United Kingdom",CA:"Canada",DE:"Germany",FR:"France",AU:"Australia",JP:"Japan",BR:"Brazil",IN:"India",IT:"Italy",ES:"Spain",NL:"Netherlands",SE:"Sweden",NO:"Norway",DK:"Denmark"}[e]||e),A=e=>{const s={};e?.forEach(e=>{const a=new Date(e.played_at).toISOString().split("T")[0];s[a]=(s[a]||0)+1});const a=[],t=new Date;for(let r=11;r>=0;r--){const e=new Date(t.getFullYear(),t.getMonth()-r,1),l=e.toISOString().split("T")[0];a.push({label:e.toLocaleDateString("en-US",{month:"short"}),plays:s[l]||Math.floor(1e3*Math.random())+100})}return a},M={labels:C.map(e=>e.label),datasets:[{label:"Total Plays",data:C.map(e=>e.plays),borderColor:"rgb(147, 51, 234)",backgroundColor:"rgba(147, 51, 234, 0.1)",tension:.4,fill:!0}]},D={labels:g.map(e=>e.name),datasets:[{label:"Plays",data:g.map(e=>e.plays),backgroundColor:["rgba(147, 51, 234, 0.8)","rgba(59, 130, 246, 0.8)","rgba(16, 185, 129, 0.8)","rgba(245, 158, 11, 0.8)"],borderColor:["rgba(147, 51, 234, 1)","rgba(59, 130, 246, 1)","rgba(16, 185, 129, 1)","rgba(245, 158, 11, 1)"],borderWidth:1}]},U={labels:T.map(e=>e.name),datasets:[{data:T.map(e=>e.plays),backgroundColor:["rgba(30, 215, 96, 0.8)","rgba(251, 146, 60, 0.8)","rgba(255, 0, 0, 0.8)","rgba(255, 193, 7, 0.8)"],borderColor:["rgba(30, 215, 96, 1)","rgba(251, 146, 60, 1)","rgba(255, 0, 0, 1)","rgba(255, 193, 7, 1)"],borderWidth:2}]},R={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"}},x:{grid:{color:"rgba(0, 0, 0, 0.1)"}}}};return c?t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-32 mb-2 animate-pulse"}),t.jsx("div",{className:"h-4 bg-gray-200 rounded w-64 animate-pulse"})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"h-10 bg-gray-200 rounded w-32 animate-pulse"}),t.jsx("div",{className:"h-10 bg-gray-200 rounded w-32 animate-pulse"})]})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>t.jsx("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:t.jsx("div",{className:"animate-pulse",children:t.jsx("div",{className:"h-16 bg-gray-200 rounded"})})},e))})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics"}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Track your music performance and growth"})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("select",{value:i,onChange:e=>n(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[t.jsx("option",{value:"7d",children:"Last 7 days"}),t.jsx("option",{value:"30d",children:"Last 30 days"}),t.jsx("option",{value:"90d",children:"Last 90 days"}),t.jsx("option",{value:"1y",children:"Last year"})]}),t.jsxs("button",{className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center gap-2",children:[t.jsx(u,{className:"h-4 w-4"}),"Export Data"]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[t.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Plays"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.totalPlays.toLocaleString()})]}),t.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:t.jsx(y,{className:"h-6 w-6 text-blue-600"})})]}),t.jsxs("div",{className:"flex items-center mt-2",children:[t.jsx(N,{className:"h-4 w-4 text-green-500 mr-1"}),t.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",m.playGrowth,"%"]}),t.jsx("span",{className:"text-sm text-gray-500 ml-1",children:"vs last period"})]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Total Listeners"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.totalListeners.toLocaleString()})]}),t.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:t.jsx(f,{className:"h-6 w-6 text-green-600"})})]}),t.jsxs("div",{className:"flex items-center mt-2",children:[t.jsx(N,{className:"h-4 w-4 text-green-500 mr-1"}),t.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",m.listenerGrowth,"%"]}),t.jsx("span",{className:"text-sm text-gray-500 ml-1",children:"vs last period"})]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Followers"}),t.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.totalFollowers.toLocaleString()})]}),t.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:t.jsx(f,{className:"h-6 w-6 text-purple-600"})})]}),t.jsxs("div",{className:"flex items-center mt-2",children:[t.jsx(N,{className:"h-4 w-4 text-green-500 mr-1"}),t.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",m.followerGrowth,"%"]}),t.jsx("span",{className:"text-sm text-gray-500 ml-1",children:"vs last period"})]})]}),t.jsxs("div",{className:"bg-white p-6 rounded-lg border border-gray-200",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm text-gray-600",children:"Revenue"}),t.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",m.totalRevenue.toLocaleString()]})]}),t.jsx("div",{className:"p-3 bg-yellow-100 rounded-lg",children:t.jsx(v,{className:"h-6 w-6 text-yellow-600"})})]}),t.jsxs("div",{className:"flex items-center mt-2",children:[t.jsx(N,{className:"h-4 w-4 text-green-500 mr-1"}),t.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",m.revenueGrowth,"%"]}),t.jsx("span",{className:"text-sm text-gray-500 ml-1",children:"vs last period"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Tracks"}),t.jsx("div",{className:"space-y-4",children:g.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:t.jsxs("span",{className:"text-sm font-medium text-purple-600",children:["#",s+1]})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsxs("p",{className:"text-xs text-gray-500",children:[e.plays.toLocaleString()," plays"]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[e.growth>0?t.jsx(N,{className:"h-4 w-4 text-green-500"}):t.jsx(w,{className:"h-4 w-4 text-red-500"}),t.jsxs("span",{className:"text-sm font-medium "+(e.growth>0?"text-green-600":"text-red-600"),children:[e.growth>0?"+":"",e.growth,"%"]})]})]},s))})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Countries"}),t.jsx("div",{className:"space-y-4",children:L.map((e,s)=>t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(S,{className:"h-4 w-4 text-gray-400"}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.country})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.plays.toLocaleString()}),t.jsxs("p",{className:"text-xs text-gray-500",children:[e.percentage,"%"]})]})]}),t.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:t.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${e.percentage}%`}})})]},s))})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Platform Performance"}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:T.map((e,s)=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-3",children:t.jsx(v,{className:"h-8 w-8 text-gray-600"})}),t.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:e.name}),t.jsx("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:e.plays.toLocaleString()}),t.jsxs("p",{className:"text-xs text-gray-500",children:[e.percentage,"% of total plays"]})]},s))})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Plays Over Time"}),t.jsx("div",{className:"h-80",children:t.jsx(p,{data:M,options:R})})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Tracks Performance"}),t.jsx("div",{className:"h-80",children:t.jsx(j,{data:D,options:R})})]})]}),t.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Platform Distribution"}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsx("div",{className:"h-80",children:t.jsx(b,{data:U,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}}})}),t.jsx("div",{className:"flex flex-col justify-center",children:t.jsx("div",{className:"space-y-4",children:T.map((e,s)=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:U.datasets[0].backgroundColor[s]}}),t.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.name})]}),t.jsxs("div",{className:"text-right",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900",children:e.plays.toLocaleString()}),t.jsxs("p",{className:"text-xs text-gray-500",children:[e.percentage,"%"]})]})]},s))})})]})]})]})};export{L as A};
